<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Understanding Elements &mdash; Mapbender3 Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/mapbender3.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '3.0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/mapbender3.ico"/>
    <link rel="top" title="Mapbender3 Documentation" href="../../../index.html" />
    <link rel="up" title="Introduction" href="introduction.html" />
    <link rel="next" title="Frontend architecture (Status Version 3.0.3.0)" href="frontend_architecture.html" />
    <link rel="prev" title="Request / Response Workflow" href="requestresponse.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="frontend_architecture.html" title="Frontend architecture (Status Version 3.0.3.0)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="requestresponse.html" title="Request / Response Workflow"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Mapbender3 Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Welcome to Mapbender3&#8217;s documentation!</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../development.html" >The Developer&#8217;s Book</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="introduction.html" accesskey="U">Introduction</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="understanding-elements">
<span id="elements"></span><h1>Understanding Elements<a class="headerlink" href="#understanding-elements" title="Permalink to this headline">¶</a></h1>
<p><em>Note</em>: This guide is under complete restructuring. We will provide a new documentation in the Contributing Guite in our Git-Repository:</p>
<p><a class="reference external" href="https://github.com/mapbender/mapbender-starter/blob/release/3.0.6/CONTRIBUTING.md#elements">https://github.com/mapbender/mapbender-starter/blob/release/3.0.6/CONTRIBUTING.md#elements</a>.</p>
<div class="section" id="parts-of-an-elements">
<h2>Parts of an Elements<a class="headerlink" href="#parts-of-an-elements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="php-class">
<h3>PHP Class<a class="headerlink" href="#php-class" title="Permalink to this headline">¶</a></h3>
<p>TODO</p>
</div>
<div class="section" id="twig-template">
<h3>Twig Template<a class="headerlink" href="#twig-template" title="Permalink to this headline">¶</a></h3>
<p>Every Element must have an HTML element it is represented by. In the most basic case, this can be a simple DIV element,
but this can be complex as needed.</p>
<p>For HTML generation Mapbender3 uses <a class="reference external" href="http://twig.sensiolabs.org/">Twig</a>. A minimal twig template for an element would
like this:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">id</span> <span class="cp">}}</span><span class="s">&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-element mb-element-myclass&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>As you can see you need to set the id (generated by Mapbender) as well as the general mb-element class and a class
specifically for your element.</p>
</div>
<div class="section" id="javascript-widgets">
<h3>JavaScript Widgets<a class="headerlink" href="#javascript-widgets" title="Permalink to this headline">¶</a></h3>
<p>Element widgets are build using the jQuery UI
<a class="reference external" href="http://wiki.jqueryui.com/w/page/12138135/Widget%20factory">widget factory</a>. This ensures a common pattern for widget
development and offers</p>
<ul class="simple">
<li>default options.</li>
<li>constructors and (optional) destructors.</li>
<li>private and public methods.</li>
</ul>
<p>The basic skeleton looks like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

<span class="c1">// This is the widget factory. It will create an widget class &quot;mbMyClass&quot; in the jQuery object as well as an</span>
<span class="c1">// &quot;mbMyClass&quot; object in the &quot;mapbender&quot; namespace in the jQuery object (they are used differently). Be sure</span>
<span class="c1">// to use the &quot;mb&quot; prefix for your widget name as not to overwrite existing jQuery functions.</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s1">&#39;mapbender.mbMyClass&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="c1">// This sets up the default options which can be overriden in the Mapbender configuration.</span>
    <span class="c1">// This will be moved into the PHP class at a later point.</span>
    <span class="c1">// The final options object can be accessed as &quot;this.options&quot;.</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">foo</span><span class="o">:</span>    <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
        <span class="nx">answer</span><span class="o">:</span> <span class="mi">42</span>
    <span class="p">},</span>

    <span class="c1">// This attribute is private for your widget.</span>
    <span class="nx">var1</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

    <span class="c1">// Constructor, gets called on widget initialization.</span>
    <span class="nx">_create</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Do everything needed for set up here, for example event handling</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;mbmyclassmagicdone&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onMagicDone</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_clickCallback</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">},</span>

    <span class="c1">// Destructore, here set to the jQuery empty function</span>
    <span class="nx">destroy</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">noop</span><span class="p">,</span>

    <span class="c1">// Public function, callable like &quot;$(&#39;#element-13&#39;).mbMyClass(&#39;methodA&#39;, parameterA, parameterB)&quot;</span>
    <span class="nx">methodA</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parameterA</span><span class="p">,</span> <span class="nx">parameterB</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_methodB</span><span class="p">(</span><span class="nx">parameterA</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="c1">// Private function, only callable from within this widget</span>
    <span class="nx">_methodB</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parameterA</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// The triggered signal will be named &quot;mbmyclassmagicdone&quot; (all lowercase)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_trigger</span><span class="p">(</span><span class="s1">&#39;magicdone&#39;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_onMagicDone</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Oh, magic!&quot;</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_clickCallback</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

<span class="p">});</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</pre></div>
</div>
<p>For event handling, jQuery.proxy is your friend to ensure that the callback is guaranteed to be executed in the right
context:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// ...</span>

<span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_clickCallback</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

<span class="c1">// ...</span>
</pre></div>
</div>
<p>This way, &#8220;this&#8221; inside the clickCallback method is the this given as the second parameter here (usually the widget
instance) and not the HTML element which triggered the event. To access the HTML event, use the target property of
the event passed as the argument to the clickCallback method.</p>
</div>
</div>
<div class="section" id="element-to-element-communication">
<h2>Element to Element communication<a class="headerlink" href="#element-to-element-communication" title="Permalink to this headline">¶</a></h2>
<p>There&#8217;s an active and an passive way to communicate with another widget. The first - active - way is to call a public
method of the other widget. For that you need to select the widget&#8217;s HTML element with jQuery and call the method like
this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">otherElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#element-13&#39;</span><span class="p">).</span><span class="nx">mbMyClass</span><span class="p">(</span><span class="s1">&#39;methodA&#39;</span><span class="p">,</span> <span class="nx">parameterA</span><span class="p">,</span> <span class="nx">parameterB</span><span class="p">);</span>
</pre></div>
</div>
<p>This is standard jQuery UI stuff and pretty much self-explanatory. The more tricky question is how do you know the
other&#8217;s HTML element? As you can see, using the id to select the element is preferred, but these ids are generated
on the fly by Mapbender3 when the application is started, so you can&#8217;t assume that the id is the always the same.
Luckily you can pass a Element id in the configuration as the target options for an Element. This will be replaced
with the run-time id of that target Elements&#8217; HTML element for you, so that in your widget code you can access the
right id as &#8220;this.options.target&#8221;.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">mbMyClass</span><span class="p">(</span><span class="s1">&#39;methodA&#39;</span><span class="p">,</span> <span class="nx">parameterA</span><span class="p">,</span> <span class="nx">parameterB</span><span class="p">);</span>
</pre></div>
</div>
<p>The passive way for communication is to subscribe to events of another target. You also need to know the HTML element,
but you can now listen for the other widget to call your widget. This is done using standard jQuery events. Well, almost
standard jQuery events:</p>
<p>If you use the &#8220;_trigger&#8221; method provided by the jQuery UI widget factory</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/mapbender3_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Understanding Elements</a><ul>
<li><a class="reference internal" href="#parts-of-an-elements">Parts of an Elements</a><ul>
<li><a class="reference internal" href="#php-class">PHP Class</a></li>
<li><a class="reference internal" href="#twig-template">Twig Template</a></li>
<li><a class="reference internal" href="#javascript-widgets">JavaScript Widgets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#element-to-element-communication">Element to Element communication</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="requestresponse.html"
                        title="previous chapter">Request / Response Workflow</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="frontend_architecture.html"
                        title="next chapter">Frontend architecture (Status Version 3.0.3.0)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/en/book/development/elements.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="frontend_architecture.html" title="Frontend architecture (Status Version 3.0.3.0)"
             >next</a> |</li>
        <li class="right" >
          <a href="requestresponse.html" title="Request / Response Workflow"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Mapbender3 Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Welcome to Mapbender3&#8217;s documentation!</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../development.html" >The Developer&#8217;s Book</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="introduction.html" >Introduction</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, The Mapbender Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>